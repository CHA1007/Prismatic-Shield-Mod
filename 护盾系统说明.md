# 护盾系统使用说明

## 功能简介

这是一个为NeoForge 1.21.1设计的能力护盾系统，可以自动拦截和偏转玩家周围一定半径内的弹射物。

## 核心特性

- ✅ 使用新的 **AttachmentType** 系统（替代旧的Capability）
- ✅ 自动拦截玩家周围的弹射物（箭、雪球、火球等）
- ✅ 可配置护盾半径（0.5-20格）
- ✅ 护盾强度系统（每次拦截消耗1点强度）
- ✅ 完整的游戏内命令支持
- ✅ 数据持久化（使用Codec序列化）

## 技术实现

### 1. AttachmentType系统
使用NeoForge 1.21.1的新AttachmentType系统来存储玩家的护盾数据：
- `ShieldCapability` - 使用Record定义不可变数据结构
- `ShieldCapabilities` - 注册AttachmentType
- 自动序列化和反序列化（通过Codec）

### 2. 数据结构
```java
public record ShieldCapability(
    boolean active,      // 护盾是否激活
    double radius,       // 护盾半径（格）
    int strength         // 护盾强度
)
```

### 3. 弹射物拦截机制
- 监听 `LivingEvent.LivingTickEvent`
- 检测玩家周围的弹射物
- 反射弹射物方向
- 改变弹射物所有者为玩家

## 游戏内命令

所有命令需要管理员权限（OP等级2）：

```
/shield toggle          # 切换护盾开关
/shield on             # 激活护盾
/shield off            # 关闭护盾
/shield radius <值>    # 设置护盾半径（0.5-20.0）
/shield strength <值>  # 设置护盾强度（0-10000）
/shield info           # 查看护盾信息
```

## 使用示例

```
# 激活护盾
/shield on

# 设置护盾半径为5格
/shield radius 5.0

# 设置护盾强度为1000
/shield strength 1000

# 查看当前护盾状态
/shield info

# 关闭护盾
/shield off
```

## 默认配置

- 护盾激活状态：**未激活**
- 默认半径：**3.0格**
- 默认强度：**100点**

## 代码结构

```
capability/
  ├── IShieldCapability.java          # 护盾接口
  ├── ShieldCapability.java           # 护盾数据类（Record）
  └── ShieldCapabilities.java         # AttachmentType注册

command/
  └── ShieldCommand.java               # 命令实现

event/
  └── ShieldEventHandler.java         # 弹射物拦截逻辑

util/
  └── ShieldManager.java               # 护盾管理工具类
```

## 扩展功能建议

1. **视觉效果**
   - 在拦截弹射物时添加粒子效果
   - 护盾激活时显示屏障粒子

2. **音效**
   - 添加护盾激活/关闭音效
   - 拦截弹射物时的音效

3. **物品系统**
   - 创建护盾物品
   - 右键激活/关闭护盾
   - 物品NBT存储护盾配置

4. **能量系统**
   - 集成能量系统（如FE/RF）
   - 护盾消耗能量而非强度点数

5. **升级系统**
   - 护盾等级系统
   - 更高等级增加半径和强度

## 注意事项

1. **性能优化**：当前每tick检查一次弹射物，在大量玩家的服务器上可能需要优化
2. **平衡性**：默认配置可能需要根据游戏平衡性调整
3. **兼容性**：已测试基础弹射物，特殊mod弹射物可能需要额外处理

## 常见问题

**Q: 为什么使用Record而不是普通类？**
A: Record是不可变的，更符合数据容器的语义，且与Codec系统配合更好。

**Q: AttachmentType和旧的Capability有什么区别？**
A: AttachmentType是NeoForge 1.21.1的新系统，更简单、更高效，不需要Provider和LazyOptional。

**Q: 护盾数据会保存吗？**
A: 会的，通过Codec自动序列化到玩家数据中。

**Q: 可以拦截哪些弹射物？**
A: 所有继承自`Projectile`类的实体，包括箭、雪球、末影珍珠、火球等。

## 许可证

根据你的项目许可证使用。
